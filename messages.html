<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Messages</title>
  </head>
  <body class="bg-gray-50">
    <!-- Sidebar -->
    <aside class="fixed top-0 left-0 h-screen w-40 bg-blue-100 p-5">
      <p class="underline text-center font-bold">Admin Panel</p>
      <ul class="mt-5 space-y-2">
        <li>
          <a href="/admin" class="text-blue-600 hover:underline">Dashboard</a>
        </li>
        <li>
          <a href="/users" class="text-blue-600 hover:underline">Users</a>
        </li>
        <li>
          <a href="/employees" class="text-blue-600 hover:underline"
            >Employees</a
          >
        </li>
        <li>
          <a href="/addportfolio" class="text-blue-600 hover:underline"
            >Portfolio</a
          >
        </li>
        <li>
          <a href="/admin/addgallery" class="text-blue-600 hover:underline"
            >Gallery</a
          >
        </li>
        <li>
          <a href="/adminblogs" class="text-blue-600 hover:underline">Blogs</a>
        </li>
        <li>
          <a href="/messages" class="text-blue-600 hover:underline">Messages</a>
        </li>
      </ul>
      <button
        onclick="window.location.href = '/logout'"
        class="mt-5 w-full text-white bg-red-500 rounded p-2 hover:bg-red-600"
      >
        Logout
      </button>
    </aside>

    <!-- Main content -->
    <main class="ml-40 p-5 min-h-screen">
      <h1 class="text-3xl font-bold mb-5">Messages</h1>

      <!-- Messages container -->
      <div id="contact" class="space-y-4 overflow-y-auto max-h-screen">
        <!-- Messages will be loaded here -->
      </div>
    </main>

    <!-- Fetch messages -->
    <script>
      fetch("/admin/messages/data")
        .then((res) => res.json())
        .then((data) => {
          const div = document.getElementById("contact");
          div.innerHTML = ""; // Clear first
          data.forEach((m) => {
            const date = new Date(m.created_at);
            const formattedDate = !isNaN(date)
              ? date.toLocaleString()
              : m.created_at;

            div.innerHTML += `
        <div class="p-4 border rounded bg-white shadow-sm">
          <p><strong>Name:</strong> ${m.name}</p>
          <p><strong>Email:</strong> ${m.email}</p>
          <p><strong>Message:</strong> ${m.message}</p>
          <p class="text-gray-400 text-sm"><strong>Date:</strong> ${formattedDate}</p>
        </div>
      `;
          });
        })
        .catch((err) => console.error("Error fetching messages:", err));
    </script>
  </body>
</html>
